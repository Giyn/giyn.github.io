<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#6200ee"><meta name="author" content="Giyn"><meta name="copyright" content="Giyn"><meta name="generator" content="Hexo 5.1.1"><meta name="theme" content="hexo-theme-yun"><title>Selenium 的基本使用 | Giyn's Blog</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="none" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.19/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_stqaphw3j4.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/auto-render.min.js"></script><script>document.addEventListener("DOMContentLoaded", function() {
  renderMathInElement(document.body, {
    delimiters: [
      {left: "$$", right: "$$", display: true},
      {left: "$", right: "$", display: false},
      {left: "\\(", right: "\\)", display: false},
      {left: "\\[", right: "\\]", display: true}
    ]
  });
});</script><link rel="shortcut icon" type="image/svg+xml" href="/Giyn.ico"><link rel="mask-icon" href="/Giyn.ico" color="#6200ee"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="stylesheet" href="/css/hexo-theme-yun.css"><link rel="alternate" href="/atom.xml" title="Giyn's Blog" type="application/atom+xml"><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"root":"/","title":"许继元的博客","version":"1.0.0","anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"/data/sentences.json"},"local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><script src="//at.alicdn.com/t/font_1140697_stqaphw3j4.js" async></script><meta name="description" content="为何使用 Selenium在很多情况下，Ajax 请求的接口通常会包含加密的参数。由于接口的请求加上了参数，如果不深入分析并找到构造逻辑，是难以直接模拟这些 Ajax 请求的。 此时解决方法通常有两种，一种是深挖其中的逻辑，把其中的构造逻辑完全找出来，再用 Python 复现，构造 Ajax 请求；另外一种方法就是直接通过模拟浏览器的方式，绕过这个过程。 此处可以使用 Selenium 工具模拟浏">
<meta property="og:type" content="article">
<meta property="og:title" content="Selenium 的基本使用">
<meta property="og:url" content="http://giyn.work/posts/9c128aa7/index.html">
<meta property="og:site_name" content="Giyn&#39;s Blog">
<meta property="og:description" content="为何使用 Selenium在很多情况下，Ajax 请求的接口通常会包含加密的参数。由于接口的请求加上了参数，如果不深入分析并找到构造逻辑，是难以直接模拟这些 Ajax 请求的。 此时解决方法通常有两种，一种是深挖其中的逻辑，把其中的构造逻辑完全找出来，再用 Python 复现，构造 Ajax 请求；另外一种方法就是直接通过模拟浏览器的方式，绕过这个过程。 此处可以使用 Selenium 工具模拟浏">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200712223004852.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200712223506994.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200712223843444.png?0x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTk2MTc3NA==,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200712231820492.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200714152051399.png?0x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTk2MTc3NA==,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200714155451753.png?0x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTk2MTc3NA==,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200714160036407.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTk2MTc3NA==,size_16,color_FFFFFF,t_70">
<meta property="article:published_time" content="2020-09-25T14:56:06.000Z">
<meta property="article:modified_time" content="2020-09-26T03:28:31.839Z">
<meta property="article:author" content="Giyn">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Selenium">
<meta property="article:tag" content="WebCrawler">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/20200712223004852.png"><script src="/js/ui/mode.js"></script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.20.0/themes/prism.css" media="(prefers-color-scheme: light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.20.0/themes/prism-tomorrow.css" media="(prefers-color-scheme: dark)"></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info mickey-mouse"><a class="site-author-avatar" href="/about/" title="Giyn"><img width="96" loading="lazy" src="/images/avatar.png" alt="Giyn"></a><div class="site-author-name"><a href="/about/">Giyn</a></div><a class="site-name" href="/about/site.html">Giyn's Blog</a><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">60</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">21</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">41</span></a></div><a class="site-state-item hty-icon-button" href="/about/"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-open-arm-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/Giyn" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:giyn.jy@gmail.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="http://wpa.qq.com/msgrd?v=3&amp;uin=490601115&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/443380473" title="bilibili" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/jiyuan_xu" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BD%95%E4%BD%BF%E7%94%A8-Selenium"><span class="toc-number">1.</span> <span class="toc-text">为何使用 Selenium</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Selenium%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">Selenium的用法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AF%B9%E8%B1%A1%EF%BC%9A"><span class="toc-number">2.0.0.1.</span> <span class="toc-text">声明浏览器对象：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E9%A1%B5%E9%9D%A2%EF%BC%9A"><span class="toc-number">2.0.0.2.</span> <span class="toc-text">访问页面：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E8%8A%82%E7%82%B9"><span class="toc-number">2.0.0.3.</span> <span class="toc-text">查找节点</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8D%95%E4%B8%AA%E8%8A%82%E7%82%B9"><span class="toc-number">2.0.0.3.1.</span> <span class="toc-text">单个节点</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E8%8A%82%E7%82%B9"><span class="toc-number">2.0.0.3.2.</span> <span class="toc-text">多个节点</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%E4%BA%A4%E4%BA%92"><span class="toc-number">2.0.0.4.</span> <span class="toc-text">节点交互</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8A%A8%E4%BD%9C%E9%93%BE"><span class="toc-number">2.0.0.5.</span> <span class="toc-text">动作链</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C-JavaScript"><span class="toc-number">2.0.0.6.</span> <span class="toc-text">执行 JavaScript</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%8A%82%E7%82%B9%E4%BF%A1%E6%81%AF"><span class="toc-number">2.0.0.7.</span> <span class="toc-text">获取节点信息</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%B1%9E%E6%80%A7"><span class="toc-number">2.0.0.7.1.</span> <span class="toc-text">获取属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%96%87%E6%9C%AC%E5%80%BC"><span class="toc-number">2.0.0.7.2.</span> <span class="toc-text">获取文本值</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-ID%E3%80%81%E4%BD%8D%E7%BD%AE%E3%80%81%E6%A0%87%E7%AD%BE%E5%90%8D%E3%80%81%E5%A4%A7%E5%B0%8F"><span class="toc-number">2.0.0.8.</span> <span class="toc-text">获取 ID、位置、标签名、大小</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%87%E6%8D%A2-Frame"><span class="toc-number">2.0.0.9.</span> <span class="toc-text">切换 Frame</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BB%B6%E6%97%B6%E7%AD%89%E5%BE%85"><span class="toc-number">2.0.0.10.</span> <span class="toc-text">延时等待</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%9A%90%E5%BC%8F%E7%AD%89%E5%BE%85"><span class="toc-number">2.0.0.10.1.</span> <span class="toc-text">隐式等待</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%98%BE%E5%BC%8F%E7%AD%89%E5%BE%85"><span class="toc-number">2.0.0.10.2.</span> <span class="toc-text">显式等待</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%AD%89%E5%BE%85%E6%9D%A1%E4%BB%B6%EF%BC%9A"><span class="toc-number">2.0.0.10.3.</span> <span class="toc-text">等待条件：</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%89%8D%E8%BF%9B%E5%90%8E%E9%80%80"><span class="toc-number">2.0.0.11.</span> <span class="toc-text">前进后退</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Cookies"><span class="toc-number">2.0.0.12.</span> <span class="toc-text">Cookies</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%89%E9%A1%B9%E5%8D%A1%E7%AE%A1%E7%90%86"><span class="toc-number">2.0.0.13.</span> <span class="toc-text">选项卡管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">2.0.0.14.</span> <span class="toc-text">异常处理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%8D%E5%B1%8F%E8%94%BD"><span class="toc-number">2.0.0.15.</span> <span class="toc-text">反屏蔽</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A0%E5%A4%B4%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.0.0.16.</span> <span class="toc-text">无头模式</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://giyn.work/posts/9c128aa7/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Giyn"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Giyn's Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Selenium 的基本使用<a class="post-edit-link" href="https://github.com/Giyn/giyn.github.io/tree/hexo/source/_posts/Selenium 的基本使用.md" target="_blank" title="Edit this post" rel="noopener"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-edit-line"></use></svg></a></h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <span class="post-meta-icon-text">Posted on</span> <time title="Created: 2020-09-25 22:56:06" itemprop="dateCreated datePublished" datetime="2020-09-25T22:56:06+08:00">2020-09-25</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <span class="post-meta-icon-text">Edited on</span> <time title="Modified: 2020-09-26 11:28:31" itemprop="dateModified" datetime="2020-09-26T11:28:31+08:00">2020-09-26</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="Words count in article"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-file-word-line"></use></svg></span> <span title="Words count in article">5.4k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="Reading time"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-timer-line"></use></svg></span> <span title="Reading time">24m</span></span></span><div class="post-classify"><span class="post-category"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category" href="/categories/Selenium/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">Selenium</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag" href="/tags/Python/" style="--text-color:#3776ab"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">Python</span></a><a class="tag" href="/tags/Selenium/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">Selenium</span></a><a class="tag" href="/tags/WebCrawler/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">WebCrawler</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#6200ee;"><h2 id="为何使用-Selenium"><a href="#为何使用-Selenium" class="headerlink" title="为何使用 Selenium"></a>为何使用 Selenium</h2><p>在很多情况下，Ajax 请求的接口通常会包含加密的参数。由于接口的请求加上了参数，如果不深入分析并找到构造逻辑，是难以直接模拟这些 Ajax 请求的。</p>
<p>此时解决方法通常有两种，一种是深挖其中的逻辑，把其中的构造逻辑完全找出来，再用 Python 复现，构造 Ajax 请求；另外一种方法就是直接通过模拟浏览器的方式，绕过这个过程。</p>
<p>此处可以使用 Selenium 工具模拟浏览器爬取。</p>
<blockquote>
<p>Selenium 是一个自动化测试工具，利用它可以驱动浏览器执行特定的动作，如点击、下拉等操作，同时还可以获取浏览器当前呈现的页面源代码，做到可见即可爬。对于一些使用 JavaScript 动态渲染的页面来说，此种抓取方式非常有效。</p>
</blockquote>
<hr>
<h2 id="Selenium的用法"><a href="#Selenium的用法" class="headerlink" title="Selenium的用法"></a>Selenium的用法</h2><h5 id="声明浏览器对象："><a href="#声明浏览器对象：" class="headerlink" title="声明浏览器对象："></a>声明浏览器对象：</h5><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span> 
browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Firefox<span class="token punctuation">(</span><span class="token punctuation">)</span> 
browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Edge<span class="token punctuation">(</span><span class="token punctuation">)</span> 
browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Safari<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>这样就完成了浏览器对象的初始化并将其赋值为 browser 对象。接下来要做的就是调用 browser 对象，让其执行各个动作以模拟浏览器操作。</p>
<hr>
<h5 id="访问页面："><a href="#访问页面：" class="headerlink" title="访问页面："></a>访问页面：</h5><p>可以用 get 方法来请求网页，只需要把参数传入链接 URL 即可。比如，这里用 get 方法访问百度，然后打印出源代码，代码如下：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> time
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>browser<span class="token punctuation">.</span>page_source<span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>运行代码后会弹出 Chrome 浏览器并且自动访问百度，然后控制台会输出百度页面的源代码，10 秒后浏览器关闭。</p>
<img src="https://img-blog.csdnimg.cn/20200712223004852.png" width="80%" loading="lazy">
<img src="https://img-blog.csdnimg.cn/20200712223506994.png" width="80%" loading="lazy">


<hr>
<h5 id="查找节点"><a href="#查找节点" class="headerlink" title="查找节点"></a>查找节点</h5><p>Selenium 可以驱动浏览器完成各种操作，比如填充表单、模拟点击等。当我们想要完成向某个输入框输入文字的操作时，首先需要知道这个输入框在哪，而 Selenium 提供了一系列查找节点的方法，可以用这些方法来获取想要的节点，以便执行下一步动作或者提取信息。</p>
<h6 id="单个节点"><a href="#单个节点" class="headerlink" title="单个节点"></a>单个节点</h6><p>当我们想要从百度页面中提取搜索框节点，首先要观察它的源代码：<br><img src="https://img-blog.csdnimg.cn/20200712223843444.png?0x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTk2MTc3NA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" loading="lazy"></p>
<p>可以发现，它的 id 是 kw，name 是 wd，此外还有许多其他属性。此时我们就可以用多种方式获取它了。比如，find_element_by_name 代表根据 name 值获取，find_element_by_id 则是根据 id 获取，另外，还有根据 XPath、CSS 选择器等获取的方式：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

browser<span class="token operator">=</span>webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span>
input_first <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'kw'</span><span class="token punctuation">)</span>
input_second <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//*[@id="kw"]'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>input_first<span class="token punctuation">,</span> input_second<span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p><strong>Output：</strong></p>
<pre class="language-none"><code class="language-none">&lt;selenium.webdriver.remote.webelement.WebElement (session&#x3D;&quot;d2f6a6403d125ae6df4055652621ac0e&quot;, element&#x3D;&quot;27afc75f-3751-482e-b62b-2721b02c9e98&quot;)&gt;
&lt;selenium.webdriver.remote.webelement.WebElement (session&#x3D;&quot;d2f6a6403d125ae6df4055652621ac0e&quot;, element&#x3D;&quot;27afc75f-3751-482e-b62b-2721b02c9e98&quot;)&gt;</code></pre>

<pre class="language-none"><code class="language-none">这里列出所有获取单个节点的方法：
find_element_by_id 
find_element_by_name 
find_element_by_xpath 
find_element_by_link_text 
find_element_by_partial_link_text 
find_element_by_tag_name 
find_element_by_class_name 
find_element_by_css_selector</code></pre>
<p>另外，Selenium 还提供了 find_element 这个通用方法，它需要传入两个参数：查找方式 By 和值：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>by <span class="token keyword">import</span> By

browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.taobao.com'</span><span class="token punctuation">)</span>
input_ <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">'q'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>input_<span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>这种查找方式的功能和上面列举的查找函数完全一致，不过参数更加灵活。</p>
<h6 id="多个节点"><a href="#多个节点" class="headerlink" title="多个节点"></a>多个节点</h6><p>如果在网页中有多个节点需要查找，要用 find_elements 这样的方法，例如要获取百度热榜的内容：</p>
<img src="https://img-blog.csdnimg.cn/20200712231820492.png" width="40%" loading="lazy">

<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> time
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span>
lis<span class="token operator">=</span>browser<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">"//div[1]/div[1]/div[5]/div/div/div[3]/ul/li"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>lis<span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p><strong>Output：</strong></p>
<pre class="language-none"><code class="language-none">[&lt;selenium.webdriver.remote.webelement.WebElement (session&#x3D;&quot;e72283ba0c520929c93f1a9075ebdd8f&quot;, element&#x3D;&quot;d48cc9a8-c10b-4762-a8c3-b333d16c0050&quot;)&gt;, 
&lt;selenium.webdriver.remote.webelement.WebElement (session&#x3D;&quot;e72283ba0c520929c93f1a9075ebdd8f&quot;, element&#x3D;&quot;b130131c-fdd7-4e3f-af04-20a4b9007d5d&quot;)&gt;, 
&lt;selenium.webdriver.remote.webelement.WebElement (session&#x3D;&quot;e72283ba0c520929c93f1a9075ebdd8f&quot;, element&#x3D;&quot;b2251221-348d-4f28-ba07-46f22e14de1f&quot;)&gt;, 
&lt;selenium.webdriver.remote.webelement.WebElement (session&#x3D;&quot;e72283ba0c520929c93f1a9075ebdd8f&quot;, element&#x3D;&quot;98b63893-bdc6-473a-bcad-68301ad5e5de&quot;)&gt;, 
&lt;selenium.webdriver.remote.webelement.WebElement (session&#x3D;&quot;e72283ba0c520929c93f1a9075ebdd8f&quot;, element&#x3D;&quot;aa0d225e-fd9a-4b94-8900-7cad59849755&quot;)&gt;, 
&lt;selenium.webdriver.remote.webelement.WebElement (session&#x3D;&quot;e72283ba0c520929c93f1a9075ebdd8f&quot;, element&#x3D;&quot;667d8cb3-8500-4d7f-868b-38c0d90af961&quot;)&gt;]</code></pre>
<p>可以看到，得到的内容变成了列表类型，列表中的每个节点都是 WebElement 类型。</p>
<blockquote>
<p>如果用 find_element 方法，只能获取匹配的第一个节点，结果是 WebElement 类型。<br>如果用 find_elements 方法，则结果是列表类型，列表中的每个节点是 WebElement 类型。</p>
</blockquote>
<pre class="language-none"><code class="language-none">这里列出所有获取多个节点的方法：
find_elements_by_id 
find_elements_by_name 
find_elements_by_xpath 
find_elements_by_link_text 
find_elements_by_partial_link_text 
find_elements_by_tag_name 
find_elements_by_class_name 
find_elements_by_css_selector</code></pre>

<hr>
<h5 id="节点交互"><a href="#节点交互" class="headerlink" title="节点交互"></a>节点交互</h5><p>Selenium 可以驱动浏览器来执行一些操作，或者说可以让浏览器模拟执行一些动作。比较常见的用法有：输入文字时用 send_keys 方法，清空文字时用 clear 方法，点击按钮时用 click 方法，举个例子：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">import</span> time

browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span>
input_ <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//div[1]/div[1]/div[5]/div/div/form/span[1]/input'</span><span class="token punctuation">)</span>
input_<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'Python'</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
input_<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
input_<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'许继元'</span><span class="token punctuation">)</span>
button <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//div[1]/div[1]/div[5]/div/div/form/span[2]/input'</span><span class="token punctuation">)</span>
button<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>


<hr>
<h5 id="动作链"><a href="#动作链" class="headerlink" title="动作链"></a>动作链</h5><p>除了针对某个节点执行的一些交互动作，还有另外一些操作，它们没有特定的执行对象，比如鼠标拖拽、键盘按键等，这些动作用另一种方式来执行，那就是动作链。举个例子，现在要实现将某个节点从一处拖拽到另外一处：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver <span class="token keyword">import</span> ActionChains

browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
url <span class="token operator">=</span> <span class="token string">'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token string">'iframeResult'</span><span class="token punctuation">)</span>
source <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//*[@id="draggable"]'</span><span class="token punctuation">)</span>
target <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//*[@id="droppable"]'</span><span class="token punctuation">)</span>
actions <span class="token operator">=</span> ActionChains<span class="token punctuation">(</span>browser<span class="token punctuation">)</span>
actions<span class="token punctuation">.</span>drag_and_drop<span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span>
actions<span class="token punctuation">.</span>perform<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<hr>
<h5 id="执行-JavaScript"><a href="#执行-JavaScript" class="headerlink" title="执行 JavaScript"></a>执行 JavaScript</h5><p>Selenium API 并没有提供实现某些操作的方法，比如下拉进度条。但它可以直接模拟运行 JavaScript，此时使用 execute_script 方法即可实现：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.zhihu.com/explore'</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">'window.scrollTo(0, document.body.scrollHeight)'</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">'alert("To Bottom")'</span><span class="token punctuation">)</span></code></pre>

<p>这里利用 execute_script 方法将进度条下拉到最底部，然后弹出 alert 提示框。</p>
<p>有了这个方法，基本上 API 没有提供的所有功能都可以用执行 JavaScript 的方式来实现了。</p>
<hr>
<h5 id="获取节点信息"><a href="#获取节点信息" class="headerlink" title="获取节点信息"></a>获取节点信息</h5><p>通过 page_source 属性可以获取网页的源代码，接着使用解析库提取信息。但 Selenium 提供了选择节点的方法，并且返回的是 WebElement 类型，则它也有相关的方法和属性来直接提取节点信息，如属性、文本等。这样就可以不用通过解析源代码来提取信息了。</p>
<h6 id="获取属性"><a href="#获取属性" class="headerlink" title="获取属性"></a>获取属性</h6><p>先选中节点，再使用 get_attribute 方法来获取节点的属性：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
url <span class="token operator">=</span> <span class="token string">'https://www.baidu.com/'</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
logo <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_class_name<span class="token punctuation">(</span><span class="token string">'s-hotsearch-content'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>logo<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>logo<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p><strong>Output：</strong></p>
<pre class="language-none"><code class="language-none">&lt;selenium.webdriver.remote.webelement.WebElement (session&#x3D;&quot;93869ad40b93b047111cb97606815423&quot;, element&#x3D;&quot;8b32fd1f-b592-4c4f-a651-63f19caaa524&quot;)&gt;
hotsearch-content-wrapper</code></pre>
<h6 id="获取文本值"><a href="#获取文本值" class="headerlink" title="获取文本值"></a>获取文本值</h6><p>每个 WebElement 节点都有 text 属性，直接调用这个属性就可以得到节点内部的文本信息：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
url <span class="token operator">=</span> <span class="token string">'https://www.baidu.com/'</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
input_ <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_class_name<span class="token punctuation">(</span><span class="token string">'hot-title'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>input_<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre>
<p><strong>Output：</strong></p>
<pre class="language-none"><code class="language-none">百度热榜</code></pre>

<hr>
<h5 id="获取-ID、位置、标签名、大小"><a href="#获取-ID、位置、标签名、大小" class="headerlink" title="获取 ID、位置、标签名、大小"></a>获取 ID、位置、标签名、大小</h5><p>WebElement 节点还有其他属性，比如 id 属性可以获取节点 id，location 属性可以获取该节点在页面中的相对位置，tag_name 属性可以获取标签名称，size 属性可以获取节点的大小，也就是宽高，例如：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
url <span class="token operator">=</span> <span class="token string">'https://www.bilibili.com/'</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
input_ <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_class_name<span class="token punctuation">(</span><span class="token string">'primary-menu-itnl'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>input_<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>input_<span class="token punctuation">.</span>location<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>input_<span class="token punctuation">.</span>tag_name<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>input_<span class="token punctuation">.</span>size<span class="token punctuation">)</span></code></pre>
<p>Output：</p>
<pre class="language-none"><code class="language-none">7ad2640f-b1cf-4635-8178-eddce14e73b4
&#123;&#39;x&#39;: 10, &#39;y&#39;: 155&#125;
div
&#123;&#39;height&#39;: 108, &#39;width&#39;: 999&#125;</code></pre>

<hr>
<h5 id="切换-Frame"><a href="#切换-Frame" class="headerlink" title="切换 Frame"></a>切换 Frame</h5><p>网页中有一种节点叫作 iframe，也就是子 Frame，相当于页面的子页面，它的结构和外部网页的结构完全一致。Selenium 打开页面后，默认是在父级 Frame 里面操作，而此时如果页面中还有子 Frame，Selenium 是不能获取到子 Frame 里面的节点的。这时就需要使用 switch_to.frame 方法来切换 Frame：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>common<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> NoSuchElementException

browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
url <span class="token operator">=</span> <span class="token string">'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token string">'iframeResult'</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    logo <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_class_name<span class="token punctuation">(</span><span class="token string">'logo'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> NoSuchElementException<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'NO LOGO'</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>parent_frame<span class="token punctuation">(</span><span class="token punctuation">)</span>
logo <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_class_name<span class="token punctuation">(</span><span class="token string">'logo'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>logo<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>logo<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre>
<p>首先通过 switch_to.frame 方法切换到子 Frame 里面，然后尝试获取子 Frame 里的 logo 节点（实际上是不能找到的），若找不到，就会抛出 NoSuchElementException 异常。接下来切换回父级 Frame，然后重新获取节点，则可以成功获取。</p>
<p><strong>Output：</strong></p>
<pre class="language-none"><code class="language-none">NO LOGO
&lt;selenium.webdriver.remote.webelement.WebElement (session&#x3D;&quot;70eb5ef47851fceefb1b7cd9a0c5026e&quot;, element&#x3D;&quot;a4000bc2-1bb7-4e88-960d-a61a7b69eb7c&quot;)&gt;
RUNOOB.COM</code></pre>
<p>当页面中包含子 Frame 时，如果想获取子 Frame 中的节点，需要先调用 switch_to.frame 方法切换到对应的 Frame，然后再进行操作。</p>
<hr>
<h5 id="延时等待"><a href="#延时等待" class="headerlink" title="延时等待"></a>延时等待</h5><p>在 Selenium 中，get 方法会在网页框架加载结束后结束执行，此时如果获取 page_source，可能并不是浏览器完全加载完成的页面，如果某些页面有额外的 Ajax 请求，我们在网页源代码中不一定能成功获取到。所以，这里需要延时等待一定时间，确保节点已经加载出来。</p>
<p>这里等待的方式有两种：一种是隐式等待，一种是显式等待。</p>
<h6 id="隐式等待"><a href="#隐式等待" class="headerlink" title="隐式等待"></a>隐式等待</h6><p>当使用隐式等待执行测试的时候，如果 Selenium 没有在 DOM 中找到节点，将继续等待，超出设定时间后，则抛出找不到节点的异常。换句话说，隐式等待可以在我们查找节点而节点并没有立即出现的时候，等待一段时间再查找 DOM，默认的时间是 0。例如：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.bilibili.com/'</span><span class="token punctuation">)</span>
input_ <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_class_name<span class="token punctuation">(</span><span class="token string">'logo-img'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>input_<span class="token punctuation">)</span></code></pre>
<p><strong>Output：</strong></p>
<pre class="language-none"><code class="language-none">&lt;selenium.webdriver.remote.webelement.WebElement (session&#x3D;&quot;f8a1bdd5fca3e2e3f1d1081bdf8dd94a&quot;, element&#x3D;&quot;dd78cc2c-bab0-4a8e-8215-d9d0dcdab8eb&quot;)&gt;</code></pre>
<h6 id="显式等待"><a href="#显式等待" class="headerlink" title="显式等待"></a>显式等待</h6><p>隐式等待的效果并没有那么好，因为只规定了一个固定时间，而页面的加载时间会受到网络条件的影响。</p>
<p>有一种更合适的显式等待方法，它指定要查找的节点，然后指定一个最长等待时间。如果在规定时间内加载出来了这个节点，就返回查找的节点；如果到了规定时间依然没有加载出该节点，则抛出超时异常。例如：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>by <span class="token keyword">import</span> By
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>support<span class="token punctuation">.</span>ui <span class="token keyword">import</span> WebDriverWait
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>support <span class="token keyword">import</span> expected_conditions <span class="token keyword">as</span> EC

browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.taobao.com/'</span><span class="token punctuation">)</span>
wait <span class="token operator">=</span> WebDriverWait<span class="token punctuation">(</span>browser<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
input_ <span class="token operator">=</span> wait<span class="token punctuation">.</span>until<span class="token punctuation">(</span>EC<span class="token punctuation">.</span>presence_of_element_located<span class="token punctuation">(</span><span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
button <span class="token operator">=</span>  wait<span class="token punctuation">.</span>until<span class="token punctuation">(</span>EC<span class="token punctuation">.</span>element_to_be_clickable<span class="token punctuation">(</span><span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> <span class="token string">'/html/body/div[2]/div/div/div[2]/div/div[1]/div[2]/form/div[1]/button'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>input_<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span></code></pre>
<p>首先引入 WebDriverWait 对象，指定最长等待时间，然后调用它的 until() 方法，传入要等待条件 expected_conditions。此处传入了 presence_of_element_located 条件，代表节点出现，其参数是节点的定位元组，也就是 ID 为 q 的节点搜索框。</p>
<p>因此，在 10 秒内如果 ID 为 q 的节点（即搜索框）成功加载出来，就返回该节点；如果超过 10 秒还没有加载出来，就抛出异常。</p>
<p>对于按钮，可以更改等待条件为 element_to_be_clickable（可点击），所以查找按钮时先查找 Xpath 为 <code>/html/body/div[2]/div/div/div[2]/div/div[1]/div[2]/form/div[1]/button</code> 的按钮，如果 10 秒内它是可点击的，就代表它成功加载出来了，则返回这个按钮节点；如果超过 10 秒还不可点击，也就是没有加载出来，就抛出异常。</p>
<p><strong>Output：</strong></p>
<pre class="language-none"><code class="language-none">&lt;selenium.webdriver.remote.webelement.WebElement (session&#x3D;&quot;1dd8bab4f5f4e1d26dc29e6fd9e33275&quot;, element&#x3D;&quot;305397ec-fc99-4c4b-9762-cd1d4c94090c&quot;)&gt; 
&lt;selenium.webdriver.remote.webelement.WebElement (session&#x3D;&quot;1dd8bab4f5f4e1d26dc29e6fd9e33275&quot;, element&#x3D;&quot;d4118061-c3b4-44b0-8fea-0745d73c58fc&quot;)&gt;</code></pre>

<p>如果 10 秒内没有成功加载，则抛出 TimeoutException 异常。</p>
<h6 id="等待条件："><a href="#等待条件：" class="headerlink" title="等待条件："></a>等待条件：</h6><table>
<thead>
<tr>
<th>等待条件</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>title_is</td>
<td>标题是某内容</td>
</tr>
<tr>
<td>title_contains</td>
<td>标题包含某内容</td>
</tr>
<tr>
<td>presence_of_element_located</td>
<td>节点加载出，传入定位元组，如 (By.ID, ‘p’)</td>
</tr>
<tr>
<td>visibility_of_element_located</td>
<td>节点可见，传入定位元组</td>
</tr>
<tr>
<td>visibility_of</td>
<td>可见，传入节点对象</td>
</tr>
<tr>
<td>presence_of_all_elements_located</td>
<td>所有节点加载出</td>
</tr>
<tr>
<td>text_to_be_present_in_element</td>
<td>某个节点文本包含某文字</td>
</tr>
<tr>
<td>text_to_be_present_in_element_value</td>
<td>某个节点值包含某文字</td>
</tr>
<tr>
<td>frame_to_be_available_and_switch_to_it frame</td>
<td>加载并切换</td>
</tr>
<tr>
<td>invisibility_of_element_located</td>
<td>节点不可见</td>
</tr>
<tr>
<td>element_to_be_clickable</td>
<td>节点可点击</td>
</tr>
<tr>
<td>staleness_of</td>
<td>判断一个节点是否仍在 DOM，可判断页面是否已经刷新</td>
</tr>
<tr>
<td>element_to_be_selected</td>
<td>节点可选择，传节点对象</td>
</tr>
<tr>
<td>element_located_to_be_selected</td>
<td>节点可选择，传入定位元组</td>
</tr>
<tr>
<td>element_selection_state_to_be</td>
<td>传入节点对象以及状态，相等返回 True，否则返回 False</td>
</tr>
<tr>
<td>element_located_selection_state_to_be</td>
<td>传入定位元组以及状态，相等返回 True，否则返回 False</td>
</tr>
<tr>
<td>alert_is_present</td>
<td>是否出现 Alert</td>
</tr>
<tr>
<td>invisibility_of_element_located</td>
<td>节点不可见</td>
</tr>
</tbody></table>
<hr>
<h5 id="前进后退"><a href="#前进后退" class="headerlink" title="前进后退"></a>前进后退</h5><p>Selenium 使用 back 方法后退，使用 forward 方法前进：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> time
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.taobao.com/'</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.python.org/'</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>back<span class="token punctuation">(</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>forward<span class="token punctuation">(</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<hr>
<h5 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h5><p>Selenium 可以方便地对 Cookies 进行操作，例如获取、添加、删除 Cookies 等：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.zhihu.com/explore'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>browser<span class="token punctuation">.</span>get_cookies<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>add_cookie<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'domain'</span><span class="token punctuation">:</span> <span class="token string">'www.zhihu.com'</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">:</span> <span class="token string">'germey'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>browser<span class="token punctuation">.</span>get_cookies<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>delete_all_cookies<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>browser<span class="token punctuation">.</span>get_cookies<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p><strong>Output：</strong></p>
<pre class="language-none"><code class="language-none">[&#123;&#39;domain&#39;: &#39;.zhihu.com&#39;, &#39;expiry&#39;: 1594790583, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;_gid&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;GA1.2.1462052348.1594704184&#39;&#125;, &#123;&#39;domain&#39;: &#39;.zhihu.com&#39;, &#39;expiry&#39;: 1657776183, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;_ga&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;GA1.2.1542833660.1594704184&#39;&#125;, &#123;&#39;domain&#39;: &#39;www.zhihu.com&#39;, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;KLBRSID&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;031b5396d5ab406499e2ac6fe1bb1a43|1594704183|1594704182&#39;&#125;, &#123;&#39;domain&#39;: &#39;.zhihu.com&#39;, &#39;expiry&#39;: 1626240183, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;Hm_lvt_98beee57fd2ef70ccdd5ca52b9740c49&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;1594704184&#39;&#125;, &#123;&#39;domain&#39;: &#39;.zhihu.com&#39;, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;Hm_lpvt_98beee57fd2ef70ccdd5ca52b9740c49&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;1594704184&#39;&#125;, &#123;&#39;domain&#39;: &#39;.zhihu.com&#39;, &#39;expiry&#39;: 1594704243, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;_gat_gtag_UA_149949619_1&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;1&#39;&#125;, &#123;&#39;domain&#39;: &#39;.zhihu.com&#39;, &#39;expiry&#39;: 1689312182, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;d_c0&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;&quot;ABBSJ1oFkxGPTirgBoF55isXJsyZ7AHpPfI&#x3D;|1594704182&quot;&#39;&#125;, &#123;&#39;domain&#39;: &#39;www.zhihu.com&#39;, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;SESSIONID&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;9dviPRsE7McwBJnMo9mpFtJwci26vXThpMAk4aguPv2&#39;&#125;, &#123;&#39;domain&#39;: &#39;.zhihu.com&#39;, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;_xsrf&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;99a2430a-941e-49f1-bc70-132ac12adda6&#39;&#125;, &#123;&#39;domain&#39;: &#39;.zhihu.com&#39;, &#39;expiry&#39;: 1657776182, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;_zap&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;44078cd7-5d9b-4f68-a673-6dd9532aad61&#39;&#125;]
[&#123;&#39;domain&#39;: &#39;.www.zhihu.com&#39;, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;name&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: True, &#39;value&#39;: &#39;germey&#39;&#125;, &#123;&#39;domain&#39;: &#39;.zhihu.com&#39;, &#39;expiry&#39;: 1594790583, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;_gid&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;GA1.2.1462052348.1594704184&#39;&#125;, &#123;&#39;domain&#39;: &#39;.zhihu.com&#39;, &#39;expiry&#39;: 1657776183, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;_ga&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;GA1.2.1542833660.1594704184&#39;&#125;, &#123;&#39;domain&#39;: &#39;www.zhihu.com&#39;, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;KLBRSID&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;031b5396d5ab406499e2ac6fe1bb1a43|1594704183|1594704182&#39;&#125;, &#123;&#39;domain&#39;: &#39;.zhihu.com&#39;, &#39;expiry&#39;: 1626240183, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;Hm_lvt_98beee57fd2ef70ccdd5ca52b9740c49&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;1594704184&#39;&#125;, &#123;&#39;domain&#39;: &#39;.zhihu.com&#39;, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;Hm_lpvt_98beee57fd2ef70ccdd5ca52b9740c49&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;1594704184&#39;&#125;, &#123;&#39;domain&#39;: &#39;.zhihu.com&#39;, &#39;expiry&#39;: 1594704243, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;_gat_gtag_UA_149949619_1&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;1&#39;&#125;, &#123;&#39;domain&#39;: &#39;.zhihu.com&#39;, &#39;expiry&#39;: 1689312182, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;d_c0&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;&quot;ABBSJ1oFkxGPTirgBoF55isXJsyZ7AHpPfI&#x3D;|1594704182&quot;&#39;&#125;, &#123;&#39;domain&#39;: &#39;www.zhihu.com&#39;, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;SESSIONID&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;9dviPRsE7McwBJnMo9mpFtJwci26vXThpMAk4aguPv2&#39;&#125;, &#123;&#39;domain&#39;: &#39;.zhihu.com&#39;, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;_xsrf&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;99a2430a-941e-49f1-bc70-132ac12adda6&#39;&#125;, &#123;&#39;domain&#39;: &#39;.zhihu.com&#39;, &#39;expiry&#39;: 1657776182, &#39;httpOnly&#39;: False, &#39;name&#39;: &#39;_zap&#39;, &#39;path&#39;: &#39;&#x2F;&#39;, &#39;secure&#39;: False, &#39;value&#39;: &#39;44078cd7-5d9b-4f68-a673-6dd9532aad61&#39;&#125;]
[]</code></pre>

<hr>
<h5 id="选项卡管理"><a href="#选项卡管理" class="headerlink" title="选项卡管理"></a>选项卡管理</h5><p>在访问网页的时候，我们通常会开启多个选项卡。而在 Selenium 中也可以对选项卡进行操作：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> time
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">'window.open()'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>browser<span class="token punctuation">.</span>window_handles<span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>window<span class="token punctuation">(</span>browser<span class="token punctuation">.</span>window_handles<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.taobao.com'</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>window<span class="token punctuation">(</span>browser<span class="token punctuation">.</span>window_handles<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://python.org'</span><span class="token punctuation">)</span></code></pre>
<p><strong>Output：</strong></p>
<pre class="language-none"><code class="language-none">[&#39;CDwindow-9833CBA347F30F83AA57A71A2D98ECC7&#39;, &#39;CDwindow-4542CB4D2539341C9EF511F46A46EE6A&#39;]</code></pre>
<p>首先访问百度，然后调用 execute_script 方法，传入 JavaScript 语句 window.open，新开启一个选项卡，调用 window_handles 属性获取当前开启的所有选项卡的代号列表。调用 switch_to.window 方法即可切换选项卡，参数是选项卡的代号。此处将第 2 个选项卡代号传入，即跳转到第 2 个选项卡，接下来在第 2 个选项卡下访问淘宝，然后重新调用 switch_to.window 方法返回第 1 个选项卡，再访问 Python 官网。</p>
<hr>
<h5 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h5><p>在使用 Selenium 的过程中，难免会遇到一些异常，例如超时、节点未找到等错误，一旦出现此类错误，程序便不会继续运行了。这里我们可以使用 try except 语句来捕获各种异常。</p>
<p>首先，演示一下节点未找到的异常：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span></code></pre>
<p><strong>Output：</strong></p>
<pre class="language-none"><code class="language-none">NoSuchElementException: no such element: Unable to locate element: &#123;&quot;method&quot;:&quot;css selector&quot;,&quot;selector&quot;:&quot;[id&#x3D;&quot;hello&quot;]&quot;&#125;
  (Session info: chrome&#x3D;83.0.4103.116)</code></pre>
<p>此处抛出了 NoSuchElementException 异常，通常代表节点未找到。</p>
<p>为了防止程序遇到异常而中断，我们需要捕获异常：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>common<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> TimeoutException<span class="token punctuation">,</span> NoSuchElementException

browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> TimeoutException<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Time Out'</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    browser<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> NoSuchElementException<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'No Element'</span><span class="token punctuation">)</span>
<span class="token keyword">finally</span><span class="token punctuation">:</span>
    browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p><strong>Output：</strong></p>
<pre class="language-none"><code class="language-none">No Element</code></pre>

<hr>
<h5 id="反屏蔽"><a href="#反屏蔽" class="headerlink" title="反屏蔽"></a>反屏蔽</h5><p>如今很多网站都加上了对 Selenium 的检测，来防止一些爬虫的恶意爬取。检测的基本原理是检测当前浏览器窗口下的 window.navigator 对象是否包含 webdriver 属性。在正常使用浏览器的情况下，这个属性是 undefined，一旦我们使用了 Selenium，Selenium 会给 window.navigator 设置 webdriver 属性。很多网站就通过 JavaScript 判断，如果 webdriver 属性存在，则直接屏蔽。</p>
<p>有一个典型的案例网站：<code>https://antispider1.scrape.cuiqingcai.com/</code>，它使用了上述原理实现了 WebDriver 的检测，如果使用 Selenium 直接爬取的话，则返回如下页面：<br><img src="https://img-blog.csdnimg.cn/20200714152051399.png?0x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTk2MTc3NA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" loading="lazy"><br>或许可以使用 JavaScript，通过调用 execute_script 方法把 webdriver 属性置空：</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript">Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>navigator<span class="token punctuation">,</span> <span class="token string">"webdriver"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">undefined</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>
<p>该 JavaScript 代码的确可以把 webdriver 属性置空，但 execute_script 调用该 JavaScript 语句实际上是在页面加载完毕之后才执行的，这太迟了，网站早在最初页面渲染之前就已经对 webdriver 属性进行了检测，所以上述方法不能达到效果。</p>
<p>然而在 Selenium 中可以使用 CDP（Chrome Devtools-Protocol，Chrome 开发工具协议）来解决该问题，通过 CDP 可以实现在每个页面刚加载时执行 JavaScript 代码，执行的 CDP 方法为 Page.addScriptToEvaluateOnNewDocument，然后传入上述的 JavaScript 代码即可在每次页面加载之前将 webdriver 属性置空。另外可以加入几个选项来隐藏 WebDriver 提示条和自动化扩展信息：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver <span class="token keyword">import</span> ChromeOptions

option <span class="token operator">=</span> ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
option<span class="token punctuation">.</span>add_experimental_option<span class="token punctuation">(</span><span class="token string">'excludeSwitches'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'enable-automation'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
option<span class="token punctuation">.</span>add_experimental_option<span class="token punctuation">(</span><span class="token string">'useAutomationExtension'</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>options<span class="token operator">=</span>option<span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>execute_cdp_cmd<span class="token punctuation">(</span><span class="token string">'Page.addScriptToEvaluateOnNewDocument'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
   <span class="token string">'source'</span><span class="token punctuation">:</span> <span class="token string">'Object.defineProperty(navigator, "webdriver", &#123;get: () => undefined&#125;)'</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://antispider1.scrape.cuiqingcai.com/'</span><span class="token punctuation">)</span></code></pre>
<p><strong>Output：</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20200714155451753.png?0x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTk2MTc3NA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" loading="lazy"></p>
<p>对于大多数的情况，以上方法均可以实现 Selenium 反屏蔽。但对于一些特殊的网站，如果其有更多的 WebDriver 特征检测，则需具体排查。</p>
<hr>
<h5 id="无头模式"><a href="#无头模式" class="headerlink" title="无头模式"></a>无头模式</h5><p>上述案例运行时，总会弹出一个浏览器窗口，虽然有助于观察页面爬取状况，但有时窗口弹来弹去也会形成干扰。</p>
<p>Chrome 浏览器从 60 版本已经支持了无头模式，即 Headless。无头模式在运行时不会弹出浏览器窗口，减少了干扰和一些资源（如图片等）的加载，所以在一定程度上节省了资源加载时间和网络带宽。</p>
<p>我们可以借助 ChromeOptions 来开启 Chrome Headless 模式：</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver <span class="token keyword">import</span> ChromeOptions

option <span class="token operator">=</span> <span class="token function">ChromeOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
option<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token string">'--headless'</span><span class="token punctuation">)</span>
browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span><span class="token function">Chrome</span><span class="token punctuation">(</span>options<span class="token operator">=</span>option<span class="token punctuation">)</span>
browser<span class="token punctuation">.</span><span class="token function">set_window_size</span><span class="token punctuation">(</span><span class="token number">1366</span><span class="token punctuation">,</span> <span class="token number">768</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span><span class="token function">get_screenshot_as_file</span><span class="token punctuation">(</span><span class="token string">'preview.png'</span><span class="token punctuation">)</span></code></pre>
<p>此处通过 ChromeOptions 的 add_argument 方法添加了参数 –headless，开启了无头模式。在无头模式下，最好设置窗口大小，接着打开页面，最后调用 get_screenshot_as_file 方法输出页面截图。</p>
<p>运行代码，Chrome 窗口没有弹出来，而代码依然正常运行，最后输出页面截图 <strong><code>preview.png</code>：</strong><br><img src="https://img-blog.csdnimg.cn/20200714160036407.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTk2MTc3NA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" loading="lazy"></p>
<p>这样就在无头模式下完成了页面的抓取和截图操作。</p>
<p>以上就是 Selenium 的基本使用，有了 Selenium，处理 JavaScript 渲染的页面就不难了。</p>
<hr>
<p>Reference：<a target="_blank" rel="noopener" href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=46#/detail/pc?id=1675">https://kaiwu.lagou.com/course/courseInfo.htm?courseId=46#/detail/pc?id=1675</a></p>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="Donate" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="qr" style="display:none;"><div style="display:inline-block"><a href="/images/Ali-Pay.jpg"><img loading="lazy" src="/images/Ali-Pay.jpg" alt="Ali-Pay" title="Ali-Pay"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a href="/images/WeChatPay.jpg"><img loading="lazy" src="/images/WeChatPay.jpg" alt="WeChat Pay" title="WeChat Pay"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>Giyn</li><li class="post-copyright-link"><strong>Post link: </strong><a href="http://giyn.work/posts/9c128aa7/" title="Selenium 的基本使用">http://giyn.work/posts/9c128aa7/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> unless stating additionally.</li></ul><script>document.addEventListener('copy', function (event) {
  const clipboardData = event.clipboardData || window.clipboardData;
  if (!clipboardData) { return; }
  const text = window.getSelection().toString();
  if (text) {
    event.preventDefault();
    clipboardData.setData('text/plain', text + '\n\nPost author: Giyn\nPost link: http://giyn.work/posts/9c128aa7/\nCopyright Notice: All articles in this blog are licensed under CC BY-NC-SA 4.0 unless stating additionally.');
  }
});</script></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/posts/9b785215/" rel="prev" title="多进程爬取豆瓣电影 Top250 并存入 MongoDB 数据库"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">多进程爬取豆瓣电影 Top250 并存入 MongoDB 数据库</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/posts/abf1e3d2/" rel="next" title="Ajax 的原理和分析"><span class="post-nav-text">Ajax 的原理和分析</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2020 – 2021 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> Giyn</span></div><div class="powered"><span>Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> v5.1.1</span><span class="footer-separator">|</span><span>Theme - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.0.0</span></div><div class="live_time"><span>本博客已运行</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  window.setTimeout(blog_live_time, 1000);
  const start = new Date('2020-09-03T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " 天 " + passHour + " 小时 " + passMinute + " 分 " + passSecond + " 秒";
}
blog_live_time();
</script></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#6200ee" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="Search"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="Searching..." value=""></div><div id="local-search-result"></div></div><script>const date = new Date();
const today = (date.getMonth() + 1) + "-" + date.getDate()
const mourn_days = ["4-4"]
if (mourn_days.includes(today)) {
  document.documentElement.style.filter = "grayscale(1)";
}</script></div><script defer src="/js/utils.js"></script><script defer src="/js/hexo-theme-yun.js"></script></body></html>